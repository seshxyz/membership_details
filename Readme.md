# Интеграционное API

## Описание
Интеграционное API предназначено для получения и консолидации данных о пользователях и их участии в группах ВКонтакте.

Для работы приложения необходим Docker.

Стандартный URL приложения: [http://localhost:8080](http://localhost:8080)

---

## Доступные эндпоинты

- **`/v3/api-docs/`** — JSON-представление API для подробного ознакомления с эндпоинтами.
- **`/swagger-ui/index.html`** — Swagger документация API.
- **`/auth`** — Получение токена доступа, необходимого для работы с основным эндпоинтом.
- **`/api/v1/check-user-membership`** — Основной защищённый эндпоинт для получения и консолидации данных о пользователе и его участии в группе ВКонтакте.

---

## Необходимые заголовки запросов

Для доступа к защищённому эндпоинту необходимо передавать следующие заголовки:

- `vk_service_token` — ваш VK API service token
- `Authorization Bearer` — полученный токен доступа

---

## Варианты запуска

### I. Локально на машине

1. Найдите файл `.env` по адресу `classpath:/docker` и измените переменную `KC_HOST` на `localhost`.
3. Запустите приложение вместе с окружением (Keycloak + база данных) через `docker-compose` в папке `docker`.
4. Приложение будет готово к работе только после полной инициализации окружения.

### II. Полностью в Docker контейнерах

1. Запуск приложения производится аналогично способу выше, за исключением отсутствия необходимости изменения значения переменной KC_HOST.
2. Основное приложение поднимается через 15 секунд после полной инициализации Keycloak и его базы данных.

> <h6> Примечание: образ Keycloak не имеет встроенного HTTP-хилсчек инструмента для докера, поэтому введена задержка запуска.</h6>

---

## Ключевые особенности

**Обращение к VK API**
- Для получения данных о пользователе через Apache Camel direct routes. Исключения поднимаются в Spring и обрабатываются соответствующими хандлерами

**Пустой ответ VK**
- Вызывает исключение "Пользователь не найден".

**Обработка ошибок VK**
- Ошибки от вконтакте оборачиваются своим вида респонса, но без перевода текста ошибки.

**Авторизация и аутентификация**
- С помощью провайдера OAuth 2.0 Keycloak. В демонстрационных целях используется поток Client Credentials Flow (service-to-service).

---